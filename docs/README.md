# Twitterbot-farm

"Фреймворк" для того, чтобы крутить множество ботов на одной машинке в одном окружении. Призван облегчить миграцию, при необходимости и снизить число запросов к twitter API.

## Bot

Заведует авторизацией и общением с Twibot.

Знает всё про редис - берёт оттуда id базы, token, secret итд, отдаёт их Twibot.

## Reader

Просто складирование твитов в редис. Не занимается ротацией (пока что).

## Writer

Просто постинг твитов по шаблону.

Единственный источник твитов - id базы Reader'а + id последнего обработанного твита.

Однако должен ходить в базу analyzer'а, чтобы узнать что писать не стоит.

## Analyzer

Просто анализатор запощенного Writer. Тут сложнее:

- необходимо ползать в твиттур чтобы узнать что налайкали что нет (+ диапазон по времени надо придумать)
- необходимо что-то там считать, оценки, рейты итд
- необходимо писать это что-то в свою базу

## Концепт работы

1. Reader пишет в свою базу твиты из ленты не переставая. Это источник текста для других ботов.
2. Writer периодически читает непрочитанные на своей стороне твиты от Reader и генерит на их основе свои, если рейтинг слов/словосочетаний от Analyzer ниже определённого лимита, то пропускает их.
3. Analyzer через 24 часа лезет в твиттер и анализирует насколько людям нравится сгенерированное writer'ом. Если людям не нравится это - слова/словосочетания понижаются в рейтинге, если нравится - повышаются.

Иными словами могут быть связки:

1 Reader - N пар(Writer + Analyzer)

## Схема хранилища

Пока что в качестве хранилища твитов выступает Redis. Данные будут хранится в виде:

### db 0. auth.
```
__app__ = [consumer_key, consumer_secret]

@botname =          [       role,  db_id,  token, secret, reader, analyzer,             template]
                    [-----------+-------+-------+-------+-------+---------+---------------------]
@bot14 =            [   'reader',      1, '123b', '456a',   None,     None                 None ]
@bot15 =            [   'writer',      2, '789c', '012d',      1,        3  'Гарри Поттер и {0}']
@bot15_analyst =    [ 'analyzer',      3, '789c', '012d',   None,     None                 None ]
```

### db 1. reader (example)
```
__last_readed_tweet_id__ = "2131312312"
31231412312 = "Ненавижу больницы. Тут всегда много бабушек, которые после того как покашляют, начинает вонять на все помещение."
```

### db 2. writer (example)
__last_processed_tweet_id__ = "2131312312"

### db 3. analyzer (example)
```
__last_analyzed_tweet_id__ = "2131312312"
"всё помещение" = "-1"
"всё" = "20"
"помещение" = "3"
```

# Twitterbot-utils

## Twibot

Даёт возможность авторизоваться из env или явно передать параметры.

Всё остальное по старому.

Ничего не должен знать про redis, максимум параметрами - из redis это всё дёргает Bot из фермы.
